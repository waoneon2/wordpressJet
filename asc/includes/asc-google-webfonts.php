<?php

/***** Google Webfonts & Character Subsets *****/

$mh_google_webfonts_subsets = array(
	'arabic' => esc_html__('Arabic', 'asc'),
	'cyrillic' => esc_html__('Cyrillic', 'asc'),
	'cyrillic_ext' => esc_html__('Cyrillic Extended', 'asc'),
	'greek' => esc_html__('Greek', 'asc'),
	'greek_ext' => esc_html__('Greek Extended', 'asc'),
	'hebrew' => esc_html__('Hebrew', 'asc'),
	'latin' => esc_html__('Latin', 'asc'),
	'latin_ext' => esc_html__('Latin Extended', 'asc'),
	'vietnamese' => esc_html__('Vietnamese', 'asc')
);

$mh_google_webfonts = array(
	'abeezee' => array('name' => 'ABeeZee', 'location' => 'ABeeZee', 'css' => '"ABeeZee", sans-serif'),
	'acme' => array('name' => 'Acme', 'location' => 'Acme', 'css' => '"Acme", sans-serif'),
	'adamina' => array('name' => 'Adamina', 'location' => 'Adamina', 'css' => '"Adamina", serif'),
	'alef' => array('name' => 'Alef', 'location' => 'Alef', 'css' => '"Alef", sans-serif'),
	'amaranth' => array('name' => 'Amaranth', 'location' => 'Amaranth', 'css' => '"Amaranth", sans-serif'),
	'amiri' => array('name' => 'Amiri', 'location' => 'Amiri', 'css' => '"Amiri", serif'),
	'arimo' => array('name' => 'Arimo', 'location' => 'Arimo', 'css' => '"Arimo", sans-serif'),
    'armata' => array('name' => 'Armata', 'location' => 'Armata', 'css' => '"Armata", sans-serif'),
    'arvo' => array('name' => 'Arvo', 'location' => 'Arvo', 'css' => '"Arvo", serif'),
    'asap' => array('name' => 'Asap', 'location' => 'Asap', 'css' => '"Asap", sans-serif'),
    'bitter' => array('name' => 'Bitter', 'location' => 'Bitter', 'css' => '"Bitter", serif'),
    'bree_serif' => array('name' => 'Bree Serif', 'location' => 'Bree+Serif', 'css' => '"Bree Serif", serif'),
    'cantarell' => array('name' => 'Cantarell', 'location' => 'Cantarell', 'css' => '"Cantarell", sans-serif'),
    'caudex' => array('name' => 'Caudex', 'location' => 'Caudex', 'css' => '"Caudex", serif'),
    'cousine' => array('name' => 'Cousine', 'location' => 'Cousine', 'css' => '"Cousine"'),
    'dosis' => array('name' => 'Dosis', 'location' => 'Dosis', 'css' => '"Dosis", sans-serif'),
    'droid_sans' => array('name' => 'Droid Sans', 'location' => 'Droid+Sans', 'css' => '"Droid Sans", sans-serif'),
    'droid_sans_mono' => array('name' => 'Droid Sans Mono', 'location' => 'Droid+Sans+Mono', 'css' => '"Droid Sans Mono", sans-serif'),
    'droid_serif' => array('name' => 'Droid Serif', 'location' => 'Droid+Serif', 'css' => '"Droid Serif", serif'),
    'exo' => array('name' => 'Exo', 'location' => 'Exo', 'css' => '"Exo", sans-serif'),
    'fjalla_one' => array('name' => 'Fjalla One', 'location' => 'Fjalla+One', 'css' => '"Fjalla One", sans-serif'),
    'gabriela' => array('name' => 'Gabriela', 'location' => 'Gabriela', 'css' => '"Gabriela", serif'),
    'glegoo' => array('name' => 'Glegoo', 'location' => 'Glegoo', 'css' => '"Glegoo", serif'),
    'graduate' => array('name' => 'Graduate', 'location' => 'Graduate', 'css' => '"Graduate", cursive'),
    'hammersmith_one' => array('name' => 'Hammersmith One', 'location' => 'Hammersmith+One', 'css' => '"Hammersmith One", sans-serif'),
    'hind' => array('name' => 'Hind', 'location' => 'Hind', 'css' => '"Hind", sans-serif'),
    'josefin_sans' => array('name' => 'Josefin Sans', 'location' => 'Josefin+Sans', 'css' => '"Josefin Sans", sans-serif'),
    'kanit' => array('name' => 'Kanit', 'location' => 'Kanit', 'css' => '"Kanit", sans-serif'),
    'lateef' => array('name' => 'Lateef', 'location' => 'Lateef', 'css' => '"Lateef", cursive'),
    'lato' => array('name' => 'Lato', 'location' => 'Lato', 'css' => '"Lato", sans-serif'),
    'lora' => array('name' => 'Lora', 'location' => 'Lora', 'css' => '"Lora", serif'),
    'lusitana' => array('name' => 'Lusitana', 'location' => 'Lusitana', 'css' => '"Lusitana", serif'),
    'marcellus_sc' => array('name' => 'Marcellus SC', 'location' => 'Marcellus+SC', 'css' => '"Marcellus SC", serif'),
    'merriweather' => array('name' => 'Merriweather', 'location' => 'Merriweather', 'css' => '"Merriweather", serif'),
    'merriweather_sans' => array('name' => 'Merriweather Sans', 'location' => 'Merriweather+Sans', 'css' => '"Merriweather Sans", sans-serif'),
    'monda' => array('name' => 'Monda', 'location' => 'Monda', 'css' => '"Monda", sans-serif'),
    'montserrat' => array('name' => 'Montserrat', 'location' => 'Montserrat', 'css' => '"Montserrat", sans-serif'),
    'muli' => array('name' => 'Muli', 'location' => 'Muli', 'css' => '"Muli", sans-serif'),
    'nobile' => array('name' => 'Nobile', 'location' => 'Nobile', 'css' => '"Nobile", sans-serif'),
    'noto_sans' => array('name' => 'Noto Sans', 'location' => 'Noto+Sans', 'css' => '"Noto Sans", sans-serif'),
    'noto_serif' => array('name' => 'Noto Serif', 'location' => 'Noto+Serif', 'css' => '"Noto Serif", serif'),
    'nova_slim' => array('name' => 'Nova Slim', 'location' => 'Nova+Slim', 'css' => '"Nova Slim", cursive'),
    'open_sans' => array('name' => 'Open Sans', 'location' => 'Open+Sans', 'css' => '"Open Sans", sans-serif'),
    'orienta' => array('name' => 'Orienta', 'location' => 'Orienta', 'css' => '"Orienta", sans-serif'),
    'oswald' => array('name' => 'Oswald', 'location' => 'Oswald', 'css' => '"Oswald", sans-serif'),
    'philosopher' => array('name' => 'Philosopher', 'location' => 'Philosopher', 'css' => '"Philosopher", sans-serif'),
    'playfair_display' => array('name' => 'Playfair Display', 'location' => 'Playfair+Display', 'css' => '"Playfair Display", serif'),
    'poly' => array('name' => 'Poly', 'location' => 'Poly', 'css' => '"Poly", serif'),
    'prata' => array('name' => 'Prata', 'location' => 'Prata', 'css' => '"Prata", serif'),
    'pt_sans' => array('name' => 'PT Sans', 'location' => 'PT+Sans', 'css' => '"PT Sans", sans-serif'),
    'pt_serif' => array('name' => 'PT Serif', 'location' => 'PT+Serif', 'css' => '"PT Serif", serif'),
    'raleway' => array('name' => 'Raleway', 'location' => 'Raleway', 'css' => '"Raleway", sans-serif'),
    'roboto' => array('name' => 'Roboto', 'location' => 'Roboto', 'css' => '"Roboto"'),
    'roboto_condensed' => array('name' => 'Roboto Condensed', 'location' => 'Roboto+Condensed', 'css' => '"Roboto Condensed", sans-serif'),
    'rokkitt' => array('name' => 'Rokkitt', 'location' => 'Rokkitt', 'css' => '"Rokkitt", serif'),
    'sarala' => array('name' => 'Sarala', 'location' => 'Sarala', 'css' => '"Sarala", sans-serif'),
    'scheherazade' => array('name' => 'Scheherazade', 'location' => 'Scheherazade', 'css' => '"Scheherazade", serif'),
    'slabo_27px' => array('name' => 'Slabo 27px', 'location' => 'Slabo+27px', 'css' => '"Slabo 27px", serif'),
    'sumana' => array('name' => 'Sumana', 'location' => 'Sumana', 'css' => '"Sumana", serif'),
    'tauri' => array('name' => 'Tauri', 'location' => 'Tauri', 'css' => '"Tauri", sans-serif'),
    'tinos' => array('name' => 'Tinos', 'location' => 'Tinos', 'css' => '"Tinos", serif'),
    'titillium_web' => array('name' => 'Titillium Web', 'location' => 'Titillium+Web', 'css' => '"Titillium Web", sans-serif'),
    'ubuntu' => array('name' => 'Ubuntu', 'location' => 'Ubuntu', 'css' => '"Ubuntu", sans-serif'),
    'yanone_kaffeesatz' => array('name' => 'Yanone Kaffeesatz', 'location' => 'Yanone+Kaffeesatz', 'css' => '"Yanone Kaffeesatz", sans-serif')
);

$mh_google_webfonts_list = wp_list_pluck($mh_google_webfonts, 'name');

/***** Add Custom Typography Options to Customizer *****/

function asc_typography_options($wp_customize) {
	global $mh_google_webfonts_subsets, $mh_google_webfonts_list;

	/***** Add Section *****/

	$wp_customize->add_section('mh_typo', array('title' => esc_html__('Typography', 'asc'), 'priority' => 3, 'panel' => 'mh_theme_options'));

    /***** Add Settings *****/

    $wp_customize->add_setting('asc_options[font_size]', array('default' => 17, 'type' => 'option', 'sanitize_callback' => 'asc_sanitize_integer'));
	$wp_customize->add_setting('asc_options[google_webfonts]', array('default' => 'enable', 'type' => 'option', 'sanitize_callback' => 'asc_sanitize_select'));
	$wp_customize->add_setting('asc_options[google_webfonts_subsets]', array('default' => 'latin', 'type' => 'option', 'sanitize_callback' => 'mh_sanitize_google_webfonts_subsets'));
	$wp_customize->add_setting('asc_options[font_heading]', array('default' => 'oswald', 'type' => 'option', 'sanitize_callback' => 'mh_sanitize_google_webfonts'));
	$wp_customize->add_setting('asc_options[font_body]', array('default' => 'pt_serif', 'type' => 'option', 'sanitize_callback' => 'mh_sanitize_google_webfonts'));
	$wp_customize->add_setting('asc_options[font_styles]', array('default' => '300,400,400italic,600,700', 'type' => 'option', 'sanitize_callback' => 'asc_sanitize_text'));

    /***** Add Controls *****/

    $wp_customize->add_control('font_size', array('label' => esc_html__('Change default Font Size (px)', 'asc'), 'section' => 'mh_typo', 'settings' => 'asc_options[font_size]', 'priority' => 1, 'type' => 'text'));
    $wp_customize->add_control('google_webfonts', array('label' => esc_html__('Google Webfonts', 'asc'), 'section' => 'mh_typo', 'settings' => 'asc_options[google_webfonts]', 'priority' => 2, 'type' => 'select', 'choices' => array('enable' => esc_html__('Enable', 'asc'), 'disable' => esc_html__('Disable', 'asc'))));
	$wp_customize->add_control('google_webfonts_subsets', array('label' => esc_html__('Google Webfonts Characters', 'asc'), 'section' => 'mh_typo', 'settings' => 'asc_options[google_webfonts_subsets]', 'priority' => 3, 'type' => 'select', 'choices' => $mh_google_webfonts_subsets));
	$wp_customize->add_control('font_heading', array('label' => esc_html__('Google Webfont for Headings', 'asc'), 'section' => 'mh_typo', 'settings' => 'asc_options[font_heading]', 'priority' => 4, 'type' => 'select', 'choices' => $mh_google_webfonts_list));
	$wp_customize->add_control('font_body', array('label' => esc_html__('Google Webfont for Body Text', 'asc'), 'section' => 'mh_typo', 'settings' => 'asc_options[font_body]', 'priority' => 5, 'type' => 'select', 'choices' => $mh_google_webfonts_list));
	$wp_customize->add_control('font_styles', array('label' => esc_html__('Imported Google Font Styles', 'asc'), 'section' => 'mh_typo', 'settings' => 'asc_options[font_styles]', 'priority' => 6, 'type' => 'text'));

}
add_action('customize_register', 'asc_typography_options');

/***** Data Sanitization *****/

function mh_sanitize_google_webfonts_subsets($input) {
	global $mh_google_webfonts_subsets;
    $valid = $mh_google_webfonts_subsets;
    if (array_key_exists($input, $valid)) {
        return $input;
    } else {
        return '';
    }
}

function mh_sanitize_google_webfonts($input) {
	global $mh_google_webfonts_list;
    $valid = $mh_google_webfonts_list;
    if (array_key_exists($input, $valid)) {
        return $input;
    } else {
        return '';
    }
}

/***** Default Custom Fonts *****/

if (!function_exists('asc_custom_fonts')) {
	function asc_custom_fonts() {
		$custom_fonts = wp_parse_args(
			get_option('asc_options', array()),
			asc_default_fonts()
		);
		return $custom_fonts;
	}
}

if (!function_exists('asc_default_fonts')) {
	function asc_default_fonts() {
		$default_fonts = array(
			'font_size' => 17,
			'google_webfonts' => 'enable',
			'google_webfonts_subsets' => 'latin',
			'font_heading' => 'oswald',
			'font_body' => 'pt_serif',
			'font_styles' => '300,400,400italic,600,700'
		);
		return $default_fonts;
	}
}

/***** Load Custom Fonts *****/

if (!function_exists('asc_google_webfonts')) {
	function asc_google_webfonts() {
		$asc_fonts = asc_custom_fonts();
		if ($asc_fonts['google_webfonts'] == 'enable') {
			global $mh_google_webfonts;
			$font_header_text = '';
			$font_heading = '';
			$font_styles = '';
			$font_subset = '';
			if (!empty($asc_fonts['font_styles'])) {
				$font_styles = ':' . $asc_fonts['font_styles'];
			}
			if ($asc_fonts['font_heading'] != $asc_fonts['font_body']) {
				$font_heading = '%7c' . $mh_google_webfonts[$asc_fonts['font_heading']]['location'] . esc_attr($font_styles);
			}
			if ($asc_fonts['google_webfonts_subsets'] == 'latin_ext') {
				$font_subset = '&amp;subset=latin,latin-ext';
			} elseif ($asc_fonts['google_webfonts_subsets'] == 'arabic') {
				$font_subset = '&amp;subset=latin,arabic';
			} elseif ($asc_fonts['google_webfonts_subsets'] == 'cyrillic') {
				$font_subset = '&amp;subset=latin,cyrillic';
			} elseif ($asc_fonts['google_webfonts_subsets'] == 'cyrillic_ext') {
				$font_subset = '&amp;subset=latin,cyrillic,cyrillic-ext';
			} elseif ($asc_fonts['google_webfonts_subsets'] == 'greek') {
				$font_subset = '&amp;subset=latin,greek';
			} elseif ($asc_fonts['google_webfonts_subsets'] == 'greek_ext') {
				$font_subset = '&amp;subset=latin,greek,greek-ext';
			} elseif ($asc_fonts['google_webfonts_subsets'] == 'hebrew') {
				$font_subset = '&amp;subset=latin,hebrew';
			} elseif ($asc_fonts['google_webfonts_subsets'] == 'vietnamese') {
				$font_subset = '&amp;subset=latin,vietnamese';
			}
			wp_enqueue_style('asc-google-fonts', 'https://fonts.googleapis.com/css?family=' . $mh_google_webfonts[$asc_fonts['font_body']]['location'] . esc_attr($font_styles) . $font_heading . $font_header_text . $font_subset, array(), null);
		}
	}
}
add_action('wp_enqueue_scripts', 'asc_google_webfonts');

/***** Include Typography Custom CSS *****/

if (!function_exists('asc_fonts_css')) {
	function asc_fonts_css() {
		$asc_fonts = asc_custom_fonts();
		if ($asc_fonts['google_webfonts'] == 'enable') {
			global $mh_google_webfonts;
			if (!empty($asc_fonts['font_size']) && $asc_fonts['font_size'] != 17 || $asc_fonts['font_heading'] != 'oswald' || $asc_fonts['font_body'] != 'pt_serif') {
				echo '<style type="text/css">' . "\n";
					if (!empty($asc_fonts['font_size']) && $asc_fonts['font_size'] != 17) {
						echo '.entry-content p { font-size: ' . absint($asc_fonts['font_size']) . 'px; font-size: ' . absint($asc_fonts['font_size']) / 16 . 'rem; }' . "\n";
					}
					if ($asc_fonts['font_heading'] != 'oswald') {
						echo '.header-nav, .header-sub, h1, h2, h3, h4, h5, h6, .breadcrumb, .footer-bottom, .widget-list li, .cat-item, .page_item, .menu-item, .button, .commentlist .vcard, .pagination, .asc-share-buttons { font-family: ' . $mh_google_webfonts[$asc_fonts['font_heading']]['css'] .'; }' . "\n";
					}
					if ($asc_fonts['font_body'] != 'pt_serif') {
						echo 'body { font-family: ' . $mh_google_webfonts[$asc_fonts['font_body']]['css'] . '; }' . "\n";
					}
				echo '</style>' . "\n";
			}
		}
	}
}
add_action('wp_head', 'asc_fonts_css');

?>